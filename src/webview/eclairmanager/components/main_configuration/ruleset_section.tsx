import React from "react";
import { ZephyrRulesetState, EclairStateAction } from "../../state";
import { PickPath, VscodeButton, VscodeRadio, VscodeRadioGroup, VscodeTextField } from "../common_components";
import { WebviewMessage } from "../../../../utils/eclairEvent";

export function RulesetSection(props: {
  ruleset: ZephyrRulesetState;
  dispatch_state: React.Dispatch<EclairStateAction>;
  post_message: (message: WebviewMessage) => void;
}) {
  const rulesets = [
    "ECLAIR_RULESET_FIRST_ANALYSIS",
    "ECLAIR_RULESET_STU",
    "ECLAIR_RULESET_STU_HEAVY",
    "ECLAIR_RULESET_WP",
    "ECLAIR_RULESET_STD_LIB",
    "ECLAIR_RULESET_ZEPHYR_GUIDELINES",
    "USER",
  ];

  const showUserFields = props.ruleset.selected === "USER";

  const handleUserRulesetNameEdit = () => {
    props.dispatch_state({ type: "toggle-user-ruleset-name-editing" });
  };

  return (
    <div className="section">
      <h2>Rulesets</h2>
      <VscodeRadioGroup
        orientation="vertical"
        value={props.ruleset.selected}
        onChange={(e: any) => props.dispatch_state({ type: "update-ruleset-selection", ruleset: e.target.value })}
      >
        {rulesets.map((r) => (
          <VscodeRadio key={r} name="ruleset" value={r}>
            {r === "USER" ? "user defined" : r}
          </VscodeRadio>
        ))}
      </VscodeRadioGroup>
      <div className={`grid-group-div ${showUserFields ? "" : "hidden"}`}>
        <VscodeTextField
          className="details-path-field"
          placeholder="Ruleset name (e.g. MYRULESET)"
          size="30"
          value={props.ruleset.userRulesetName}
          disabled={!props.ruleset.userRulesetNameEditing}
          onChange={(e: any) => props.dispatch_state({ type: "update-user-ruleset-name", name: e.target.value })}
          onKeyDown={(e: any) => {
            if (e.key === "Enter" && props.ruleset.userRulesetNameEditing) {
              handleUserRulesetNameEdit();
            }
          }}
        >
          Ruleset Name:
        </VscodeTextField>
        <VscodeButton appearance="primary" onClick={handleUserRulesetNameEdit}>
          {props.ruleset.userRulesetNameEditing ? "Done" : "Edit"}
        </VscodeButton>
        <PickPath
          value={props.ruleset.userRulesetPath || ""}
          name="Ruleset file"
          placeholder="path/to/analysis_config.ecl"
          on_selected={(value) => props.dispatch_state({ type: "update-user-ruleset-path", path: value })}
          on_pick={() => props.post_message({ command: "browse-user-ruleset-path" })}
        />
      </div>
    </div>
  );
}
